<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart-ParkingLot: C library for Broadcom BCM 2835 as used in Raspberry Pi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Smart-ParkingLot
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C library for Broadcom BCM 2835 as used in Raspberry Pi </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a C library for Raspberry Pi (RPi). It provides access to GPIO and other IO functions on the Broadcom BCM 2835 chip, allowing access to the GPIO pins on the 26 pin IDE plug on the RPi board so you can control and interface with various external devices.</p>
<p>It provides functions for reading digital inputs and setting digital outputs, using SPI and I2C, and for accessing the system timers. Pin event detection is supported by polling (interrupts are not supported).</p>
<p>It is C++ compatible, and installs as a header file and non-shared library on any Linux-based distro (but clearly is no use except on Raspberry Pi or another board with BCM 2835).</p>
<p>The version of the package that this documentation refers to can be downloaded from <a href="http://www.airspayce.com/mikem/bcm2835/bcm2835-1.26.tar.gz">http://www.airspayce.com/mikem/bcm2835/bcm2835-1.26.tar.gz</a> You can find the latest version at <a href="http://www.airspayce.com/mikem/bcm2835">http://www.airspayce.com/mikem/bcm2835</a></p>
<p>Several example programs are provided.</p>
<p>Based on data in <a href="http://elinux.org/RPi_Low-level_peripherals">http://elinux.org/RPi_Low-level_peripherals</a> and <a href="http://www.raspberrypi.org/wp-content/uploads/2012/02/BCM2835-ARM-Peripherals.pdf">http://www.raspberrypi.org/wp-content/uploads/2012/02/BCM2835-ARM-Peripherals.pdf</a> and <a href="http://www.scribd.com/doc/101830961/GPIO-Pads-Control2">http://www.scribd.com/doc/101830961/GPIO-Pads-Control2</a></p>
<p>You can also find online help and discussion at <a href="http://groups.google.com/group/bcm2835">http://groups.google.com/group/bcm2835</a> Please use that group for all questions and discussions on this topic. Do not contact the author directly, unless it is to discuss commercial licensing.</p>
<p>Tested on debian6-19-04-2012, 2012-07-15-wheezy-raspbian and Occidentalisv01 CAUTION: it has been observed that when detect enables such as <a class="el" href="group__gpio.html#ga8e990d48db929445ac3e899ca0f5ed07">bcm2835_gpio_len()</a> are used and the pin is pulled LOW it can cause temporary hangs on 2012-07-15-wheezy-raspbian and Occidentalisv01. Reason for this is not yet determined, but suspect that an interrupt handler is hitting a hard loop on those OSs. If you must use <a class="el" href="group__gpio.html#ga8e990d48db929445ac3e899ca0f5ed07">bcm2835_gpio_len()</a> and friends, make sure you disable the pins with bcm2835_gpio_cler_len() and friends after use.</p>
<dl class="section user"><dt>Installation</dt><dd></dd></dl>
<p>This library consists of a single non-shared library and header file, which will be installed in the usual places by make install</p>
<div class="fragment"><div class="line"><span class="preprocessor"># download the latest version of the library, say bcm2835-1.xx.tar.gz, then:</span></div>
<div class="line">tar zxvf bcm2835-1.xx.tar.gz</div>
<div class="line">cd bcm2835-1.xx</div>
<div class="line">./configure</div>
<div class="line">make</div>
<div class="line">sudo make check</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><dl class="section user"><dt>Physical Addresses</dt><dd></dd></dl>
<p>The functions <a class="el" href="group__lowlevel.html#ga5f242135f5088f8c319492426a1ed5e3">bcm2835_peri_read()</a>, <a class="el" href="group__lowlevel.html#ga639da6963ab76e3109b9909f3a9e6171">bcm2835_peri_write()</a> and <a class="el" href="group__lowlevel.html#ga01949a6285305f38ce0a47154e55c1b6">bcm2835_peri_set_bits()</a> are low level peripheral register access functions. They are designed to use physical addresses as described in section 1.2.3 ARM physical addresses of the BCM2835 ARM Peripherals manual. Physical addresses range from 0x20000000 to 0x20FFFFFF for peripherals. The bus addresses for peripherals are set up to map onto the peripheral bus address range starting at 0x7E000000. Thus a peripheral advertised in the manual at bus address 0x7Ennnnnn is available at physical address 0x20nnnnnn.</p>
<p>The base address of the various peripheral registers are available with the following externals: bcm2835_gpio bcm2835_pwm bcm2835_clk bcm2835_pads bcm2835_spio0 bcm2835_st bcm2835_bsc0 bcm2835_bsc1</p>
<dl class="section user"><dt>Pin Numbering</dt><dd></dd></dl>
<p>The GPIO pin numbering as used by RPi is different to and inconsistent with the underlying BCM 2835 chip pin numbering. <a href="http://elinux.org/RPi_BCM2835_GPIOs">http://elinux.org/RPi_BCM2835_GPIOs</a></p>
<p>RPi has a 26 pin IDE header that provides access to some of the GPIO pins on the BCM 2835, as well as power and ground pins. Not all GPIO pins on the BCM 2835 are available on the IDE header.</p>
<p>RPi Version 2 also has a P5 connector with 4 GPIO pins, 5V, 3.3V and Gnd.</p>
<p>The functions in this library are designed to be passed the BCM 2835 GPIO pin number and <em>not</em> the RPi pin number. There are symbolic definitions for each of the available pins that you should use for convenience. See <a class="el" href="group__constants.html#ga63c029bd6500167152db4e57736d0939">RPiGPIOPin</a>.</p>
<dl class="section user"><dt>SPI Pins</dt><dd></dd></dl>
<p>The bcm2835_spi_* functions allow you to control the BCM 2835 SPI0 interface, allowing you to send and received data by SPI (Serial Peripheral Interface). For more information about SPI, see <a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus</a></p>
<p>When <a class="el" href="group__spi.html#gac888dc9b78b695f6c13eeeaa813c0d82">bcm2835_spi_begin()</a> is called it changes the bahaviour of the SPI interface pins from their default GPIO behaviour in order to support SPI. While SPI is in use, you will not be able to control the state of the SPI pins through the usual bcm2835_spi_gpio_write(). When <a class="el" href="group__spi.html#gad25421b3a4a6ca280dfdd39c94c3279a">bcm2835_spi_end()</a> is called, the SPI pins will all revert to inputs, and can then be configured and controled with the usual bcm2835_gpio_* calls.</p>
<p>The Raspberry Pi GPIO pins used for SPI are:</p>
<ul>
<li>P1-19 (MOSI)</li>
<li>P1-21 (MISO)</li>
<li>P1-23 (CLK)</li>
<li>P1-24 (CE0)</li>
<li>P1-26 (CE1)</li>
</ul>
<dl class="section user"><dt>I2C Pins</dt><dd></dd></dl>
<p>The bcm2835_i2c_* functions allow you to control the BCM 2835 BSC interface, allowing you to send and received data by I2C ("eye-squared cee"; generically referred to as "two-wire interface") . For more information about I?C, see <a href="http://en.wikipedia.org/wiki/I%C2%B2C">http://en.wikipedia.org/wiki/I%C2%B2C</a></p>
<p>The Raspberry Pi V2 GPIO pins used for I2C are:</p>
<ul>
<li>P1-03 (SDA)</li>
<li>P1-05 (SLC)</li>
</ul>
<dl class="section user"><dt>Real Time performance constraints</dt><dd></dd></dl>
<p>The bcm2835 is a library for user programs (i.e. they run in 'userland'). Such programs are not part of the kernel and are usually subject to paging and swapping by the kernel while it does other things besides running your program. This means that you should not expect to get real-time performance or real-time timing constraints from such programs. In particular, there is no guarantee that the <a class="el" href="group__gpio.html#ga3ffbe079732a995cfacd691f677d9789">bcm2835_delay()</a> and <a class="el" href="group__gpio.html#gade50bd6947463a242783accf91e5b5e4">bcm2835_delayMicroseconds()</a> will return after exactly the time requested. In fact, depending on other activity on the host, IO etc, you might get significantly longer delay times than the one you asked for. So please dont expect to get exactly the time delay you request.</p>
<p>Arjan reports that you can prevent swapping on Linux with the following code fragment:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>sched_param sp;</div>
<div class="line">memset(&amp;sp, 0, <span class="keyword">sizeof</span>(sp));</div>
<div class="line">sp.sched_priority = sched_get_priority_max(SCHED_FIFO);</div>
<div class="line">sched_setscheduler(0, SCHED_FIFO, &amp;sp);</div>
<div class="line">mlockall(MCL_CURRENT | MCL_FUTURE);</div>
</div><!-- fragment --><dl class="section user"><dt>Open Source Licensing GPL V2</dt><dd></dd></dl>
<p>This is the appropriate option if you want to share the source code of your application with everyone you distribute it to, and you also want to give them the right to share who uses it. If you wish to use this software under Open Source Licensing, you must contribute all your source code to the open source community in accordance with the GPL Version 2 when your application is distributed. See <a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a> and COPYING</p>
<dl class="section user"><dt>Acknowledgements</dt><dd></dd></dl>
<p>Some of this code has been inspired by Dom and Gert. The I2C code has been inspired by Alan Barr.</p>
<dl class="section user"><dt>Revision History</dt><dd></dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 Initial release </dd>
<dd>
1.1 Minor bug fixes </dd>
<dd>
1.2 Added support for SPI </dd>
<dd>
1.3 Added <a class="el" href="group__spi.html#ga06884e9cd71dfe380f846b09f47b7248">bcm2835_spi_transfern()</a> </dd>
<dd>
1.4 Fixed a problem that prevented SPI CE1 being used. Reported by David Robinson. </dd>
<dd>
1.5 Added <a class="el" href="group__init.html#ga3a42892f61764132d106a4ae32271002">bcm2835_close()</a> to deinit the library. Suggested by C?sar Ortiz </dd>
<dd>
1.6 Document testing on 2012-07-15-wheezy-raspbian and Occidentalisv01 Functions <a class="el" href="group__gpio.html#ga5b70fa96491b9b1d9b3fb21bfefe2fd7">bcm2835_gpio_ren()</a>, <a class="el" href="group__gpio.html#gac9ea2f8c63f0330f12e1b24444d92e50">bcm2835_gpio_fen()</a>, <a class="el" href="group__gpio.html#ga2cb94aef80b49335057e338d71e46608">bcm2835_gpio_hen()</a> <a class="el" href="group__gpio.html#ga8e990d48db929445ac3e899ca0f5ed07">bcm2835_gpio_len()</a>, <a class="el" href="group__gpio.html#gaa77a0e0d39a6b4423419a16055ce71cc">bcm2835_gpio_aren()</a> and <a class="el" href="group__gpio.html#ga7e1f1686b60043c00327255e523d98f6">bcm2835_gpio_afen()</a> now changes only the pin specified. Other pins that were already previously enabled stay enabled. Added <a class="el" href="group__gpio.html#gaa5826edb1b17dd9095fa3bcae5ded485">bcm2835_gpio_clr_ren()</a>, <a class="el" href="group__gpio.html#ga196b61d8bf334be6acec590de6dc8f88">bcm2835_gpio_clr_fen()</a>, <a class="el" href="group__gpio.html#ga3c3b5297f5c2aeb5d2046a5b6de15d96">bcm2835_gpio_clr_hen()</a> <a class="el" href="group__gpio.html#gac3b51f656f5495dad715ff3c01417aea">bcm2835_gpio_clr_len()</a>, <a class="el" href="group__gpio.html#ga6f3e122871853b34d97b65284cf7cc47">bcm2835_gpio_clr_aren()</a>, <a class="el" href="group__gpio.html#ga8ec8bf224e25ed395d4eecf3ad308ca3">bcm2835_gpio_clr_afen()</a> to clear the enable for individual pins, suggested by Andreas Sundstrom. </dd>
<dd>
1.7 Added bcm2835_spi_transfernb to support different buffers for read and write. </dd>
<dd>
1.8 Improvements to read barrier, as suggested by maddin. </dd>
<dd>
1.9 Improvements contributed by mikew: I noticed that it was mallocing memory for the mmaps on /dev/mem. It's not necessary to do that, you can just mmap the file directly, so I've removed the mallocs (and frees). I've also modified delayMicroseconds() to use nanosleep() for long waits, and a busy wait on a high resolution timer for the rest. This is because I've found that calling nanosleep() takes at least 100-200 us. You need to link using '-lrt' using this version. I've added some unsigned casts to the debug prints to silence compiler warnings I was getting, fixed some typos, and changed the value of BCM2835_PAD_HYSTERESIS_ENABLED to 0x08 as per Gert van Loo's doc at <a href="http://www.scribd.com/doc/101830961/GPIO-Pads-Control2">http://www.scribd.com/doc/101830961/GPIO-Pads-Control2</a> Also added a define for the passwrd value that Gert says is needed to change pad control settings. </dd>
<dd>
1.10 Changed the names of the delay functions to <a class="el" href="group__gpio.html#ga3ffbe079732a995cfacd691f677d9789">bcm2835_delay()</a> and <a class="el" href="group__gpio.html#gade50bd6947463a242783accf91e5b5e4">bcm2835_delayMicroseconds()</a> to prevent collisions with wiringPi. Macros to map delay()-&gt; <a class="el" href="group__gpio.html#ga3ffbe079732a995cfacd691f677d9789">bcm2835_delay()</a> and Macros to map delayMicroseconds()-&gt; <a class="el" href="group__gpio.html#gade50bd6947463a242783accf91e5b5e4">bcm2835_delayMicroseconds()</a>, which can be disabled by defining BCM2835_NO_DELAY_COMPATIBILITY </dd>
<dd>
1.11 Fixed incorrect link to download file </dd>
<dd>
1.12 New GPIO pin definitions for RPi version 2 (which has a different GPIO mapping) <br  />
 </dd>
<dd>
1.13 New GPIO pin definitions for RPi version 2 plug P5 Hardware base pointers are now available (after initialisation) externally as bcm2835_gpio bcm2835_pwm bcm2835_clk bcm2835_pads bcm2835_spi0. </dd>
<dd>
1.14 Now compiles even if CLOCK_MONOTONIC_RAW is not available, uses CLOCK_MONOTONIC instead. Fixed errors in documentation of SPI divider frequencies based on 250MHz clock. Reported by Ben Simpson. </dd>
<dd>
1.15 Added <a class="el" href="group__init.html#ga3a42892f61764132d106a4ae32271002">bcm2835_close()</a> to end of examples as suggested by Mark Wolfe. </dd>
<dd>
1.16 Added bcm2835_gpio_set_multi, bcm2835_gpio_clr_multi and bcm2835_gpio_write_multi to allow a mask of pins to be set all at once. Requested by Sebastian Loncar. </dd>
<dd>
1.17 Added bcm2835_gpio_write_mask. Requested by Sebastian Loncar. </dd>
<dd>
1.18 Added bcm2835_i2c_* functions. Changes to bcm2835_delayMicroseconds: now uses the RPi system timer counter, instead of clock_gettime, for improved accuracy. No need to link with -lrt now. Contributed by Arjan van Vught. </dd>
<dd>
1.19 Removed inlines added by previous patch since they don't seem to work everywhere. Reported by olly. </dd>
<dd>
1.20 Patch from Mark Dootson to close /dev/mem after access to the peripherals has been granted. </dd>
<dd>
1.21 delayMicroseconds is now not susceptible to 32 bit timer overruns. Patch courtesy Jeremy Mortis. </dd>
<dd>
1.22 Fixed incorrect definition of BCM2835_GPFEN0 which broke the ability to set falling edge events. Reported by Mark Dootson. </dd>
<dd>
1.23 Added bcm2835_i2c_set_baudrate and bcm2835_i2c_read_register_rs. Improvements to bcm2835_i2c_read and bcm2835_i2c_write functions to fix ocasional reads not completing. Patched by Mark Dootson. </dd>
<dd>
1.24 Mark Dootson p[atched a problem with his previously submitted code under high load from other processes. </dd>
<dd>
1.25 Updated author and distribution location details to airspayce.com </dd>
<dd>
1.26 Added missing unmapmem for pads in bcm2835_close to prevent a memory leak. Reported by Hartmut Henkel. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Mike McCauley (<a href="#" onclick="location.href='mai'+'lto:'+'mik'+'em'+'@ai'+'rs'+'pay'+'ce'+'.co'+'m'; return false;">mikem<span class="obfuscator">.nosp@m.</span>@air<span class="obfuscator">.nosp@m.</span>spayc<span class="obfuscator">.nosp@m.</span>e.co<span class="obfuscator">.nosp@m.</span>m</a>) DO NOT CONTACT THE AUTHOR DIRECTLY: USE THE LISTS </dd></dl>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
